#!/usr/bin/env bash

# Copyright Â© 2019 Jakub Wilk <jwilk@jwilk.net>
# SPDX-License-Identifier: MIT

set -e -u
prog=${0##*/}
bad_usage()
{
    printf 'Usage: %s PROVIDER IDENT\n' "$prog" >&2
    printf 'Providers: inpost paczkawruchu\n' >&2
    exit 1
}
[ $# -eq 2 ] || bad_usage
provider="$1"
ident="$2"
urlget()
{
    curl \
        --user-agent 'pacz (https://github.com/jwilk/pacz)' \
        --silent --fail --show-error \
        "$@"
}
case $provider in
    inpost)
        url="https://api-shipx-pl.easypack24.net/v1/tracking/$ident"
        json=$(urlget "$url")
        jq . <<< "$json"
        ;;
    paczkawruchu)
        ts=$(date '+%s000')
        url="https://nadaj.paczkawruchu.pl/parcel/api-status?id=$ident&jsonp=callback&_=$ts"
        json=$(urlget "$url")
        json=${json#callback(}
        json=${json%);}
        jq . <<< "$json"
        ;;
    *)
        bad_usage;;
esac

# vim:ts=4 sts=4 sw=4 et
